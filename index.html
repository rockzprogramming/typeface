<html><head><base href="/" />
<meta charset="UTF-8">
<title>Google Docs Clone</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --blue-500: #4285f4;
  --gray-100: #f1f3f4;
  --gray-200: #e8eaed;
  --gray-700: #5f6368;
  --gray-400: #9aa0a6;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Inconsolata', monospace;
}

body {
  overflow-x: hidden;
}

.header {
  display: flex;
  align-items: center;
  padding: 8px 16px;
  border-bottom: 1px solid var(--gray-200);
  background: white;
  position: sticky;
  top: 0;
  z-index: 100;
  transition: box-shadow 0.3s ease;
}

.header.scrolled {
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.doc-title {
  border: none;
  font-size: 20px;
  padding: 8px 12px;
  border-radius: 8px;
  width: 250px;
  font-weight: 500;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.doc-title:hover {
  width: 350px;
}

.toolbar {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid var(--gray-200);
  gap: 24px;
  background: var(--gray-100);
}

.toolbar-group {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px;
  border-radius: 8px;
  background: white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.toolbar-button {
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: none;
  cursor: pointer;
  color: var(--gray-700);
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  margin: 0 2px;
}

.toolbar-button:hover {
  background: var(--gray-100);
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.toolbar-button:active {
  transform: translateY(1px);
}

.toolbar-button::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  opacity: 0;
  visibility: hidden;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.toolbar-button:hover::after {
  opacity: 1;
  visibility: visible;
}

.content {
  width: 100%;
  max-width: 850px;
  margin: 0 auto;
  padding: 40px;
  min-height: calc(100vh - 128px);
}

.editor {
  width: 100%;
  min-height: 1100px;
  padding: 60px;
  border: 1px solid var(--gray-200);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  outline: none;
  line-height: 1.6;
  transition: box-shadow 0.3s ease;
}

.editor:focus {
  box-shadow: 0 4px 12px rgba(66,133,244,0.2);
}

.editor[contenteditable="true"]:empty:before {
  content: "Type your document here...";
  color: var(--gray-400);
  cursor: text;
}

@keyframes saveIndicator {
  0% { opacity: 0; transform: translateY(10px); }
  10% { opacity: 1; transform: translateY(0); }
  90% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-10px); }
}

.save-indicator {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--gray-700);
  color: white;
  padding: 8px 16px;
  border-radius: 8px;
  opacity: 0;
  animation: saveIndicator 2s ease forwards;
}

.suggestion-popup {
  position: absolute;
  background: white;
  border: 1px solid var(--gray-200);
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  padding: 4px 0;
  max-width: 200px;
  z-index: 1000;
  display: none;
}

.suggestion-item {
  padding: 4px 12px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.suggestion-item:hover {
  background: var(--gray-100);
}

.themes-panel {
  position: fixed;
  right: -300px;
  top: 0;
  width: 300px;
  height: 100vh;
  background: white;
  box-shadow: -2px 0 8px rgba(0,0,0,0.1);
  transition: right 0.3s ease;
  z-index: 101;
  padding: 32px;
  overflow-y: auto;
  border-left: 1px solid var(--gray-200);
}

.themes-panel.open {
  right: 0;
}

.theme-option {
  display: flex;
  align-items: center;
  padding: 16px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: 16px;
  border: 2px solid var(--gray-200);
}

.theme-option:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.theme-preview {
  width: 56px;
  height: 56px;
  border-radius: 12px;
  margin-right: 16px;
}

select.toolbar-button {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding: 8px 24px 8px 12px;
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23666%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
  background-repeat: no-repeat;
  background-position: right 8px center;
  background-size: 8px auto;
}

select.toolbar-button option {
  background: var(--background-color, white);
  color: var(--text-color, black);
}

.editor.typing *:last-child {
  display: block; /* Reset to normal display */
  overflow: visible;
  white-space: normal;
  border-right: none; /* Remove the cursor */
}

.theme-creator-panel {
  position: fixed;
  right: -300px;
  top: 0;
  width: 300px;
  height: 100vh;
  background: white;
  box-shadow: -2px 0 8px rgba(0,0,0,0.1);
  transition: right 0.3s ease;
  z-index: 102;
  padding: 32px;
  overflow-y: auto;
  border-left: 1px solid var(--gray-200);
}

.theme-creator-panel.open {
  right: 0;
}

.input-group {
  margin-bottom: 16px;
}

.input-group label {
  display: block;
  margin-bottom: 8px;
  color: var(--gray-700);
}

.input-group input {
  width: 100%;
  padding: 8px;
  border: 1px solid var(--gray-200);
  border-radius: 4px;
}

.input-group input[type="color"] {
  height: 40px;
  padding: 2px;
}

#save-theme {
  width: 100%;
  margin-top: 16px;
  background: var(--blue-500);
  color: white;
  padding: 12px;
  border-radius: 4px;
}
</style>
</head>
<body>
  <div class="header">
    <input type="text" class="doc-title" value="Untitled document">
  </div>

  <div class="toolbar">
    <div class="toolbar-group">
      <button class="toolbar-button" data-command="undo" data-tooltip="Undo">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="redo" data-tooltip="Redo">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="bold" data-tooltip="Bold">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="italic" data-tooltip="Italic">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="underline" data-tooltip="Underline">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="strikethrough" data-tooltip="Strikethrough">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M7.24 8.75c-.26-.48-.39-1.03-.39-1.67 0-.61.13-1.16.4-1.67.26-.5.63-.93 1.11-1.29.48-.35 1.05-.63 1.7-.83.66-.19 1.39-.29 2.18-.29.81 0 1.54.11 2.21.34.66.22 1.23.54 1.69.94.47.4.83.88 1.08 1.43.25.55.38 1.15.38 1.81h-3.01c0-.31-.05-.59-.15-.85-.09-.27-.24-.49-.44-.68-.2-.19-.45-.33-.75-.44-.3-.1-.66-.16-1.06-.16-.39 0-.74.04-1.03.13-.29.09-.53.21-.72.36-.19.16-.34.34-.44.55-.1.21-.15.43-.15.66 0 .48.25.88.74 1.21.38.25.77.48 1.41.7H7.39c-.05-.08-.11-.17-.15-.25zM21 12v-2H3v2h9.62c.18.07.4.14.55.2.37.17.66.34.87.51.21.17.35.36.43.57.07.2.11.43.11.69 0 .23-.05.45-.14.66-.09.2-.23.38-.42.53-.19.15-.42.26-.71.35-.29.08-.63.13-1.01.13-.43 0-.83-.04-1.18-.13s-.66-.23-.91-.42c-.25-.19-.45-.44-.59-.75-.14-.31-.25-.76-.25-1.21H6.4c0 .55.08 1.13.24 1.58.16.45.37.85.65 1.21.28.35.6.66.98.92.37.26.78.48 1.22.65.44.17.9.3 1.38.39.48.08.96.13 1.44.13.8 0 1.53-.09 2.18-.28s1.21-.45 1.67-.79c.46-.34.82-.77 1.07-1.27s.38-1.07.38-1.71c0-.6-.1-1.14-.31-1.61-.05-.11-.11-.23-.17-.33H21z"/>
        </svg>
      </button>
    </div>

    <div class="toolbar-group">
      <select class="toolbar-button" data-command="fontSize" data-tooltip="Font size">
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11" selected>11</option>
        <option value="12">12</option>
        <option value="14">14</option>
        <option value="16">16</option>
        <option value="18">18</option>
        <option value="20">20</option>
        <option value="22">22</option>
        <option value="24">24</option>
        <option value="26">26</option>
        <option value="36">36</option>
        <option value="48">48</option>
        <option value="72">72</option>
      </select>
      <select class="toolbar-button" data-command="fontName" data-tooltip="Font family">
        <option value="Inconsolata">Inconsolata</option>
        <option value="Quicksand">Quicksand</option>
        <option value="Arial">Arial</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Courier New">Courier New</option>
        <option value="Georgia">Georgia</option>
        <option value="Verdana">Verdana</option>
        <option value="Impact">Impact</option>
        <option value="Monospace">Monospace</option>
      </select>
      <button class="toolbar-button" data-command="formatMore" data-tooltip="More options">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M7 14l5-5 5 5z"/>
        </svg>
      </button>
      <button class="toolbar-button" id="theme-toggle" data-tooltip="Themes">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
        </svg>
      </button>
      <button class="toolbar-button" id="create-theme-toggle" data-tooltip="Create Theme">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
        </svg>
      </button>
    </div>

    <div class="toolbar-group">
      <button class="toolbar-button" data-command="justifyLeft" data-tooltip="Align left">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="justifyCenter" data-tooltip="Center">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M3 21h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18V7H3v2zm0-6v2h18V3H3z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="justifyRight" data-tooltip="Align right">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/>
        </svg>
      </button>
    </div>

    <div class="toolbar-group">
      <button class="toolbar-button" data-command="insertUnorderedList" data-tooltip="Bullet list">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zm7 2h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="insertOrderedList" data-tooltip="Numbered list">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>
        </svg>
      </button>
    </div>

    <div class="toolbar-group">
      <button class="toolbar-button" data-command="outdent" data-tooltip="Decrease indent">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M11 17h10v-2H11v2zm-8-5l4 4V8l-4 4zm0 9h18v-2H3v2zM3 3v2h18V3H3zm8 6h10V7H11v2zm0 4h10v-2H11v2z"/>
        </svg>
      </button>
      <button class="toolbar-button" data-command="indent" data-tooltip="Increase indent">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M3 21h18v-2H3v2zM3 8v8l4-4-4-4zm8 9h10v-2H11v2zM3 3v2h18V3H3zm8 6h10V7H11v2zm0 4h10v-2H11v2z"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="content">
    <div class="editor" contenteditable="true">
    </div>
  </div>

  <div class="themes-panel">
    <h3>Choose Theme</h3>
    <div id="themes-list"></div>
  </div>

  <div class="theme-creator-panel">
    <h3>Create Custom Theme</h3>
    <div class="theme-creator-form">
      <div class="input-group">
        <label>Theme Name:</label>
        <input type="text" id="theme-name" placeholder="My Custom Theme">
      </div>
      <div class="input-group">
        <label>Primary Color:</label>
        <input type="color" id="primary-color">
      </div>
      <div class="input-group">
        <label>Background Color:</label>
        <input type="color" id="background-color" value="#ffffff">
      </div>
      <div class="input-group">
        <label>Text Color:</label>
        <input type="color" id="text-color" value="#000000">
      </div>
      <div class="input-group">
        <label>Accent Color:</label>
        <input type="color" id="accent-color">
      </div>
      <button id="save-theme" class="toolbar-button">Save Theme</button>
    </div>
  </div>

  <div class="suggestion-popup"></div>

<script>
// Function to save to cookies
function setCookie(name, value, days) {
  const expires = new Date();
  expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
  document.cookie = `${name}=${encodeURIComponent(value)};expires=${expires.toUTCString()};path=/`;
}

// Function to get from cookies
function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return decodeURIComponent(parts.pop().split(';').shift());
}

// Load saved theme and content on page load
document.addEventListener('DOMContentLoaded', function() {
  // Load saved theme
  const savedTheme = getCookie('selectedTheme');
  if (savedTheme) {
    const theme = themes.find(t => t.name === savedTheme);
    if (theme) applyTheme(theme);
  }

  // Load saved content
  const savedContent = getCookie('documentContent');
  if (savedContent) {
    document.querySelector('.editor').innerHTML = savedContent;
  }

  // Load saved title
  const savedTitle = getCookie('documentTitle');
  if (savedTitle) {
    document.querySelector('.doc-title').value = savedTitle;
    document.title = savedTitle + ' - Google Docs';
  }

  // Load font preference
  const savedFont = getCookie('selectedFont');
  if (savedFont) {
    const fontSelector = document.querySelector('[data-command="fontName"]');
    fontSelector.value = savedFont;
    execCommand('fontName', savedFont);
  }

  // Load custom themes on startup
  const customThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
  themes.push(...customThemes);
});

// Define themes array
const themes = [
  {name: 'Default Light', primary: '#4285f4', background: '#ffffff', text: '#000000', accent: '#e8eaed'},
  {name: 'Dark Mode', primary: '#8ab4f8', background: '#202124', text: '#ffffff', accent: '#3c4043'},
  {name: 'Ocean Blue', primary: '#0277bd', background: '#e1f5fe', text: '#01579b', accent: '#b3e5fc'},
  {name: 'Forest Green', primary: '#2e7d32', background: '#e8f5e9', text: '#1b5e20', accent: '#c8e6c9'},
  {name: 'Royal Purple', primary: '#6a1b9a', background: '#f3e5f5', text: '#4a148c', accent: '#e1bee7'},
  {name: 'Sunset Orange', primary: '#e64a19', background: '#fbe9e7', text: '#bf360c', accent: '#ffccbc'},
  {name: 'Midnight Blue', primary: '#1a237e', background: '#1a1a2e', text: '#ffffff', accent: '#534bae'},
  {name: 'Forest Night', primary: '#1b5e20', background: '#1a2f1a', text: '#ffffff', accent: '#43a047'},
  {name: 'Arctic Light', primary: '#02888d1', background: '#ffffff', text: '#000000', accent: '#e3f2fd'},
  {name: 'Pitch Dark', primary: '#64b5f6', background: '#000000', text: '#ffffff', accent: '#1a1a1a'},
  {name: 'Emerald Forest', primary: '#2e7d32', background: '#f1f8e9', text: '#1b5e20', accent: '#c8e6c9'},
  {name: 'Deep Ocean', primary: '#1565c0', background: '#0a192f', text: '#ffffff', accent: '#172a45'},
  {name: 'Desert Sand', primary: '#d84315', background: '#fff3e0', text: '#bf360c', accent: '#ffe0b2'},
  {name: 'Purple Rain', primary: '#6a1b9a', background: '#4a148c', text: '#ffffff', accent: '#7b1fa2'},
  {name: 'Mint Fresh', primary: '#00897b', background: '#e0f2f1', text: '#004d40', accent: '#b2dfdb'},
  {name: 'Cherry Blossom', primary: '#c2185b', background: '#fce4ec', text: '#880e4f', accent: '#f8bbd0'},
  {name: 'Golden Hour', primary: '#f57c00', background: '#fff3e0', text: '#e65100', accent: '#ffe0b2'},
  {name: 'Nordic Frost', primary: '#546e7a', background: '#eceff1', text: '#263238', accent: '#cfd8dc'},
];

// Function to apply theme
function applyTheme(theme) {
  // Update CSS variables
  document.documentElement.style.setProperty('--blue-500', theme.primary);
  document.documentElement.style.setProperty('--gray-100', `${theme.accent}40`);
  document.documentElement.style.setProperty('--gray-200', theme.accent);
  document.documentElement.style.setProperty('--gray-400', theme.text + '80');
  document.documentElement.style.setProperty('--gray-700', theme.text);

  // Apply to body
  document.body.style.background = theme.background;
  document.body.style.color = theme.text;

  // Apply to header
  const header = document.querySelector('.header');
  header.style.background = theme.background;
  header.style.borderColor = theme.accent;

  // Apply to editor
  const editor = document.querySelector('.editor');
  editor.style.background = theme.background;
  editor.style.color = theme.text;
  editor.style.borderColor = theme.accent;
  editor.style.boxShadow = `0 1px 3px ${theme.text}20`;

  // Apply to toolbar and buttons
  const toolbar = document.querySelector('.toolbar');
  toolbar.style.background = theme.background;
  toolbar.style.borderColor = theme.accent;

  // Apply to toolbar buttons
  const toolbarButtons = document.querySelectorAll('.toolbar-button');
  toolbarButtons.forEach(button => {
    button.style.color = theme.text;
  });

  // Apply to toolbar groups
  const toolbarGroups = document.querySelectorAll('.toolbar-group');
  toolbarGroups.forEach(group => {
    group.style.background = `${theme.accent}40`;
  });

  // Apply to select elements
  const selects = document.querySelectorAll('select.toolbar-button');
  selects.forEach(select => {
    select.style.color = theme.text;
    select.style.background = theme.background;
    select.style.borderColor = theme.accent;
    // Set CSS variables for options
    document.documentElement.style.setProperty('--background-color', theme.background);
    document.documentElement.style.setProperty('--text-color', theme.text);
  });

  // Apply to document title
  const docTitle = document.querySelector('.doc-title');
  docTitle.style.color = theme.text;
  docTitle.style.background = theme.background;

  // Apply to themes panel
  const themesPanel = document.querySelector('.themes-panel');
  themesPanel.style.background = theme.background;
  themesPanel.style.color = theme.text;
  themesPanel.style.boxShadow = `0 0 10px ${theme.text}30`;

  // Apply to theme options
  const themeOptions = document.querySelectorAll('.theme-option');
  themeOptions.forEach(option => {
    option.style.borderColor = theme.accent;
    option.style.color = theme.text;
  });

  // Save theme selection
  setCookie('selectedTheme', theme.name, 30);

  // Apply to font selector
  const fontSelector = document.querySelector('[data-command="fontName"]');
  fontSelector.style.color = theme.text;
  fontSelector.style.background = theme.background;
  fontSelector.style.borderColor = theme.accent;
}

// Populate themes panel
const themesList = document.getElementById('themes-list');
themes.forEach(theme => {
  const themeOption = document.createElement('div');
  themeOption.className = 'theme-option';
  themeOption.innerHTML = `
    <div class="theme-preview" style="background: ${theme.primary}"></div>
    <span>${theme.name}</span>
  `;
  themeOption.onclick = () => applyTheme(theme);
  themesList.appendChild(themeOption);
});

// Theme panel toggle
const themeToggle = document.getElementById('theme-toggle');
const themesPanel = document.querySelector('.themes-panel');

themeToggle.addEventListener('click', () => {
  themesPanel.classList.toggle('open');
});

// Create theme panel toggle
const createThemeToggle = document.getElementById('create-theme-toggle');
const themeCreatorPanel = document.querySelector('.theme-creator-panel');

createThemeToggle.addEventListener('click', () => {
  themeCreatorPanel.classList.toggle('open');
  themesPanel.classList.remove('open');
});

// Close themes panel when clicking outside
document.addEventListener('click', (e) => {
  if (!themesPanel.contains(e.target) && !themeToggle.contains(e.target)) {
    themesPanel.classList.remove('open');
  }
  if (!themeCreatorPanel.contains(e.target) && !createThemeToggle.contains(e.target)) {
    themeCreatorPanel.classList.remove('open');
  }
});

// Track changes for undo/redo
let undoStack = [];
let redoStack = [];
const editor = document.querySelector('.editor');

editor.addEventListener('input', (e) => {
  // Just save content after input
  setCookie('documentContent', editor.innerHTML, 30);
  saveFontPreference();
});

// Format command handler
function execCommand(command, value = null) {
  if (command.startsWith('justify')) {
    document.execCommand(command, false, null);
  } else {
    document.execCommand(command, false, value);
  }
  editor.focus();
  // Save content after formatting
  setCookie('documentContent', editor.innerHTML, 30);
}

// Font selector functionality
document.querySelector('[data-command="fontName"]').addEventListener('change', function(e) {
  execCommand('fontName', e.target.value);
});

// Save font selection to cookies
function saveFontPreference() {
  const fontSelector = document.querySelector('[data-command="fontName"]');
  setCookie('selectedFont', fontSelector.value, 30);
}

// Undo command
document.querySelector('[data-command="undo"]').addEventListener('click', () => {
  if (undoStack.length > 0) {
    redoStack.push(editor.innerHTML);
    editor.innerHTML = undoStack.pop();
    setCookie('documentContent', editor.innerHTML, 30);
  }
});

// Redo command
document.querySelector('[data-command="redo"]').addEventListener('click', () => {
  if (redoStack.length > 0) {
    undoStack.push(editor.innerHTML);
    editor.innerHTML = redoStack.pop();
    setCookie('documentContent', editor.innerHTML, 30);
  }
});

// Add event listeners to all toolbar buttons
document.querySelectorAll('.toolbar-button').forEach(button => {
  const command = button.getAttribute('data-command');
  if (command) {
    button.addEventListener('click', () => {
      if (command === 'fontSize') {
        execCommand(command, button.value);
      } else {
        execCommand(command);
      }
    });
  }
});

// Handle font size changes
document.querySelector('[data-command="fontSize"]').addEventListener('change', function(e) {
  execCommand('fontSize', e.target.value);
});

// Add export functionality to the toolbar
const exportGroup = document.createElement('div');
exportGroup.className = 'toolbar-group';
exportGroup.innerHTML = `
  <button class="toolbar-button" data-command="exportPDF" data-tooltip="Export as PDF">
    <svg viewBox="0 0 24 24" width="20" height="20">
      <path fill="currentColor" d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/>
    </svg>
  </button>
  <button class="toolbar-button" data-command="exportTXT" data-tooltip="Export as TXT">
    <svg viewBox="0 0 24 24" width="20" height="20">
      <path fill="currentColor" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/>
    </svg>
  </button>
`;

document.querySelector('.toolbar').appendChild(exportGroup);

// Add export functionality
function exportAsPDF() {
  const content = document.querySelector('.editor').innerHTML;
  const style = `
    <style>
      body { font-family: 'Inconsolata', monospace; }
      * { color: ${getComputedStyle(document.body).color} !important; }
    </style>
  `;
  
  const win = window.open('', '_blank');
  win.document.write(`<html><head>${style}</head><body>${content}</body></html>`);
  win.document.close();
  win.print();
}

function exportAsTXT() {
  const content = document.querySelector('.editor').innerText;
  const blob = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${document.querySelector('.doc-title').value || 'document'}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// Add export button event listeners
document.querySelector('[data-command="exportPDF"]').addEventListener('click', exportAsPDF);
document.querySelector('[data-command="exportTXT"]').addEventListener('click', exportAsTXT);

// Save custom theme
document.getElementById('save-theme').addEventListener('click', () => {
  const name = document.getElementById('theme-name').value || 'Custom Theme';
  const newTheme = {
    name,
    primary: document.getElementById('primary-color').value,
    background: document.getElementById('background-color').value,
    text: document.getElementById('text-color').value,
    accent: document.getElementById('accent-color').value
  };

  // Add to themes array
  themes.push(newTheme);
  
  // Save to localStorage
  localStorage.setItem('customThemes', JSON.stringify(
    themes.filter(t => !t.isDefault)
  ));
  
  // Add to themes panel
  const themeOption = document.createElement('div');
  themeOption.className = 'theme-option';
  themeOption.innerHTML = `
    <div class="theme-preview" style="background: ${newTheme.primary}"></div>
    <span>${newTheme.name}</span>
  `;
  themeOption.onclick = () => applyTheme(newTheme);
  themesList.appendChild(themeOption);
  
  // Apply the new theme
  applyTheme(newTheme);
  
  // Close panel
  themeCreatorPanel.classList.remove('open');
});

// Fix font selection
document.querySelector('[data-command="fontName"]').addEventListener('change', function(e) {
  const font = e.target.value;
  execCommand('fontName', font);
  document.execCommand('defaultParagraphSeparator', false, 'p');
  setCookie('selectedFont', font, 30);
});
</script>

</body></html>
